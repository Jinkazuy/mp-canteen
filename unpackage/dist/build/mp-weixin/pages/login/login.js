(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"86a1":function(e,t,n){"use strict";var o,r=function(){var e=this,t=e.$createElement,o=(e._self._c,n("e655"));e.$mp.data=Object.assign({},{$root:{m0:o}})},a=[];n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return o})},"9ce5":function(e,t,n){"use strict";n.r(t);var o=n("ad78"),r=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);t["default"]=r.a},a670:function(e,t,n){"use strict";n.r(t);var o=n("86a1"),r=n("9ce5");for(var a in r)"default"!==a&&function(e){n.d(t,e,function(){return r[e]})}(a);n("b33e");var u,s=n("f0c5"),i=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],u);t["default"]=i.exports},ad78:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=c(n("a34a")),r=c(n("8434")),a=n("2f62"),u=n("32c5"),s=n("af58"),i=n("e07b");function c(e){return e&&e.__esModule?e:{default:e}}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){l(e,t,n[t])})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,o,r,a,u){try{var s=e[a](u),i=s.value}catch(c){return void n(c)}s.done?t(i):Promise.resolve(i).then(o,r)}function g(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var a=e.apply(t,n);function u(e){d(a,o,r,u,s,"next",e)}function s(e){d(a,o,r,u,s,"throw",e)}u(void 0)})}}var h={data:function(){return{onLoginBTN:!1,getPhoneBTN:!1,errNum:0}},onShow:function(){var e=g(o.default.mark(function e(){return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onLoad:function(e){e.onLoadErrMsg&&(0,r.default)(e.onLoadErrMsg),e.logOut&&"1"===e.logOut&&(console.log("logOut"),this.onLoginBTN=!0,this.getPhoneBTN=!1),e.logOut||this.getSetting()},onUnload:function(){},methods:f({getSetting:function(){var t=this;r.default.loading({message:"正在登陆....",duration:0}),e.getSetting({success:function(e){e.authSetting["scope.userInfo"]?(console.log("已获取用户“用户信息授权，直接获取用户信息（非敏感数据）”"),t.getUserInfo()):(r.default.clear(),(0,r.default)("需要您的授权"),t.onLoginBTN=!0,t.getPhoneBTN=!1)}})},getUserInfo:function(){var t=this;e.getUserInfo({success:function(e){t.setUserInfo(e.userInfo),t.loginAndGetToken(e.encryptedData,e.iv)}})},bindGetUserInfo:function(e){console.log(e),e.target.userInfo?(console.log(e.target.userInfo),r.default.loading({message:"正在登陆....",duration:0}),this.setUserInfo(e.target.userInfo),this.loginAndGetToken(e.detail.encryptedData,e.detail.iv)):(0,r.default)("需要您的授权才能登录")},ifStoreUserPhone:function(){var e=g(o.default.mark(function e(){return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:""!==this.store_UserInfoData.mobile.trim()&&null!==this.store_UserInfoData.mobile?(console.log("拿到手机号，本地用户手机号↓"),console.log(this.store_UserInfoData.mobile),null!==this.store_UserInfoData.nickName&&""!==this.store_UserInfoData.nickName&&this.backOnePage()):(this.getPhoneBTN=!0,(0,r.default)("请允许获取您的手机号"),console.log("本地手机号获取为空，显示获取手机号按钮"));case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),bindgetphonenumber:function(){var e=g(o.default.mark(function e(t){var n;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("用户点击获取手机号按钮"),console.log(t),!t.detail.encryptedData){e.next=10;break}return console.log("用户授权手机号，拿到加密数据，发送给后台换取手机号"),e.next=6,(0,i.http_getPhone)(t.detail.encryptedData,t.detail.iv);case 6:n=e.sent,n?this.ifStoreUserPhone():((0,r.default)("伺服器正在调整，暂不提供登录，抱歉"),console.log("服务器解码手机号失败")),e.next=12;break;case 10:(0,r.default)("请您授权获取手机号"),console.log("用户拒绝授权获取手机号");case 12:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),loginAndGetToken:function(){var t=g(o.default.mark(function t(n,a){var i=this;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.login({success:function(){var e=g(o.default.mark(function e(t){var c,f;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t.code){e.next=31;break}return console.log("登录，获取token"),e.next=4,(0,u.http_login_setToken)(t.code,n,a);case 4:if(c=e.sent,console.log(c),c){e.next=13;break}i.onLoginBTN=!0,i.getPhoneBTN=!1,r.default.clear(),(0,r.default)("登录失败"),e.next=31;break;case 13:if(!(888===c&&i.errNum<6)){e.next=19;break}console.log("微信解码出错"),i.errNum++,i.getUserInfo(),e.next=31;break;case 19:if(!(888===c&&i.errNum>=6)){e.next=27;break}i.onLoginBTN=!0,i.getPhoneBTN=!1,i.errNum=0,r.default.clear(),(0,r.default)("登录失败，code888"),e.next=31;break;case 27:return e.next=29,(0,s.http_getUserInfoData)();case 29:f=e.sent,f&&(""===i.store_UserInfoData.mobile.trim()||null===i.store_UserInfoData.mobile?(r.default.clear(),i.onLoginBTN=!1,i.getPhoneBTN=!0,i.ifStoreUserPhone()):null!==i.store_UserInfoData.nickName&&i.backOnePage());case 31:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()});case 1:case"end":return t.stop()}},t,this)}));function n(e,n){return t.apply(this,arguments)}return n}(),backOnePage:function(){r.default.success({message:"登录成功"}),setTimeout(function(){e.navigateBack({delta:1})},2e3)}},(0,a.mapMutations)({setUserInfo:"setUserInfo",setToken:"setToken"})),computed:f({},(0,a.mapGetters)(["store_UserInfo","store_UserInfoData","store_token","store_UserPhone"]))};t.default=h}).call(this,n("543d")["default"])},b33e:function(e,t,n){"use strict";var o=n("bdef"),r=n.n(o);r.a},bdef:function(e,t,n){},fb40:function(e,t,n){"use strict";(function(e){n("261b"),n("921b");o(n("66fd"));var t=o(n("a670"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["fb40","common/runtime","common/vendor"]]]);