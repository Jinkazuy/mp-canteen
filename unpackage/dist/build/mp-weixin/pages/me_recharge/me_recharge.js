(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me_recharge/me_recharge"],{"0e96":function(e,t,n){"use strict";var r,o=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return r})},"3e9b":function(e,t,n){"use strict";var r=n("955b"),o=n.n(r);o.a},"485f":function(e,t,n){"use strict";(function(e){n("261b"),n("921b");r(n("66fd"));var t=r(n("a46b"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"52d6":function(e,t,n){"use strict";n.r(t);var r=n("6f2f"),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,function(){return r[e]})}(a);t["default"]=o.a},"6f2f":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(n("a34a")),o=n("6a2f"),a=n("ae05"),c=n("cf17"),u=n("2f62"),i=l(n("8434")),s=n("9c80");function l(e){return e&&e.__esModule?e:{default:e}}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,a,c){try{var u=e[a](c),i=u.value}catch(s){return void n(s)}u.done?t(i):Promise.resolve(i).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){d(a,r,o,c,u,"next",e)}function u(e){d(a,r,o,c,u,"throw",e)}c(void 0)})}}var g={data:function(){return{userBalance:-1,moneyNum:-1,payOBJ:{},columns:["300","400","500","600","700","800","900","1000"],pickerShowFlag:!1,isOrtherMoney:!1}},onShow:function(){var e=h(r.default.mark(function e(){var t;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.http_getUserBalance)();case 2:t=e.sent,console.log("刷新余额"),console.log(t),t?this.userBalance=store_userBalance.xx.xx:(0,i.default)("获取余额信息失败，刷新重试");case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{onRecharge:function(){var t=h(r.default.mark(function t(){var n,c,u;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,o.isLogin)();case 2:if(n=t.sent,n){t.next=6;break}return e.navigateTo({url:"../../pages/login/login"}),t.abrupt("return");case 6:return console.log("充值按钮"),console.log("openid=> "+this.store_UserInfoData.openId),console.log("充值金额=> "+this.moneyNum+"元"),c={money:100*this.moneyNum,openid:this.store_UserInfoData.openId,body:"餐厅充值"},i.default.loading({message:"支付中...",duration:0}),t.next=13,(0,a.http_toPay)(c);case 13:u=t.sent,0==u.code?(this.payOBJ=u.data,this.callPayment()):(0,i.default)("支付失败");case 15:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),selectMoney:function(e){this.moneyNum=e,this.isOrtherMoney=!1},onChange:function(e){console.log(e.detail),this.moneyNum=Number(e.detail.value)},pickerShow:function(){this.pickerShowFlag=!this.pickerShowFlag,this.isOrtherMoney=!0},onClose:function(){console.log("隐藏上拉框"),this.pickerShowFlag=!1},callPayment:function(){var t=h(r.default.mark(function t(){var n,o=this;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getServiceProvider();case 2:n=t.sent,console.log("支付对象↓"),console.log(this.payOBJ),!1!==n&&e.requestPayment({provider:n,timeStamp:this.payOBJ.timeStamp,nonceStr:this.payOBJ.nonceStr,package:"prepay_id="+this.payOBJ.prepay_id,signType:this.payOBJ.signType,paySign:this.payOBJ.paySign,_debug:0,success:function(){var e=h(r.default.mark(function e(t){var n,a;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("requestPayment:ok"!=t.errMsg){e.next=14;break}return e.next=3,(0,c.http_recharge)(o.moneyNum);case 3:if(n=e.sent,0!=n.code){e.next=14;break}return console.log("支付成功"),i.default.clear(),(0,i.default)("充值成功"),e.next=10,(0,s.http_getUserBalance)();case 10:a=e.sent,console.log("刷新余额"),console.log(a),a||(0,i.default)("获取余额信息失败，刷新重试");case 14:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),fail:function(){var e=h(r.default.mark(function e(t){var n;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("支付失败"),i.default.clear(),(0,i.default)("支付失败"),e.next=5,(0,s.http_getUserBalance)();case 5:n=e.sent,console.log("刷新余额"),console.log(n),n||(0,i.default)("获取余额信息失败，刷新重试"),console.log(t);case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()});case 6:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),getServiceProvider:function(){return new Promise(function(){var t=h(r.default.mark(function t(n,o){return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getProvider({service:"payment",success:function(e){"getProvider:ok"==e.errMsg?(console.log(e.provider[0]),n(e.provider[0])):n(!1)},fail:function(e){n(!1)}});case 2:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}())},openRecordPage:function(){e.navigateTo({url:"../../pages/me_recharge_record/me_recharge_record",complete:function(e){console.log(e)}})}},computed:f({},(0,u.mapGetters)(["store_UserInfoData","store_userBalance"]))};t.default=g}).call(this,n("543d")["default"])},"955b":function(e,t,n){},a46b:function(e,t,n){"use strict";n.r(t);var r=n("0e96"),o=n("52d6");for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);n("3e9b");var c,u=n("f0c5"),i=Object(u["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],c);t["default"]=i.exports}},[["485f","common/runtime","common/vendor"]]]);