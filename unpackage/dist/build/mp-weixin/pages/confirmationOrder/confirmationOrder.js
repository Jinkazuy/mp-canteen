(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/confirmationOrder/confirmationOrder"],{"20b6":function(e,t,o){"use strict";var s=o("dfb5"),n=o.n(s);n.a},6182:function(e,t,o){"use strict";o.r(t);var s=o("ec9a"),n=o.n(s);for(var r in s)"default"!==r&&function(e){o.d(t,e,function(){return s[e]})}(r);t["default"]=n.a},"9c9b":function(e,t,o){"use strict";(function(e){o("261b"),o("921b");s(o("66fd"));var t=s(o("c600"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},bab0:function(e,t,o){"use strict";var s,n=function(){var e=this,t=e.$createElement;e._self._c},r=[];o.d(t,"b",function(){return n}),o.d(t,"c",function(){return r}),o.d(t,"a",function(){return s})},c600:function(e,t,o){"use strict";o.r(t);var s=o("bab0"),n=o("6182");for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);o("20b6");var a,i=o("f0c5"),u=Object(i["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],a);t["default"]=u.exports},dfb5:function(e,t,o){},ec9a:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=l(o("a34a")),n=o("2f62"),r=o("6a2f"),a=o("9c80"),i=o("01e9"),u=l(o("8434"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},s=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),s.forEach(function(t){d(e,t,o[t])})}return e}function d(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function f(e,t,o,s,n,r,a){try{var i=e[r](a),u=i.value}catch(l){return void o(l)}i.done?t(u):Promise.resolve(u).then(s,n)}function h(e){return function(){var t=this,o=arguments;return new Promise(function(s,n){var r=e.apply(t,o);function a(e){f(r,s,n,a,i,"next",e)}function i(e){f(r,s,n,a,i,"throw",e)}a(void 0)})}}var p={props:{canteenID:{type:Number,default:function(){return-1}},stallID:{type:Number,default:function(){return-1}}},data:function(){return{canteenName:"",stallName:"",userGoodsCarTotalCount:-1,userGoodsCarTotalPrice:-1,userGoodsCarGoodsList:[],getFoodsTime:-1,orderDiscount:-1,orderTime:-1,payModShow:!1,userBalance:-1,didOrderId:-1}},onLoad:function(){var t=h(s.default.mark(function t(o){return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.canteenID=o.canteenID,this.stallID=o.stallID,-1!==this.canteenID&&-1!==this.stallID&&(this.computeCanteenStallGoodsCarCountAndTotalPriceAndGoodsList(this.store_userGoodsCarDatas),this.findCanteenNameAndStallName(this.store_homeCanteenList),this.getFoodsTime=this.computedGetGoodsTime()),e.setNavigationBarTitle({title:this.canteenName});case 4:case"end":return t.stop()}},t,this)}));function o(e){return t.apply(this,arguments)}return o}(),methods:c({toSettlement:function(){var t=h(s.default.mark(function t(){var o,n,i;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,r.isLogin)();case 2:if(o=t.sent,o){t.next=6;break}return e.navigateTo({url:"../../pages/login/login"}),t.abrupt("return");case 6:if(n=!0,n){t.next=9;break}return t.abrupt("return");case 9:return console.log("检查账户余额"),t.next=12,(0,a.http_getUserBalance)();case 12:i=t.sent,i?this.store_UserInfoData.id===this.store_userBalance.userId?(console.log(this.store_userBalance),this.userBalance=99,this.payModShow=!0):(0,u.default)("余额查询失败"):(0,u.default)("获取余额信息失败");case 14:case"end":return t.stop()}},t,this)}));function o(){return t.apply(this,arguments)}return o}(),computedGetGoodsTime:function(){var e=(new Date).getTime()+6e5,t=new Date(e).getHours(),o=new Date(e).getMinutes(),s=t+":"+o;return s},onClosePayMod:function(){this.payModShow=!1},toPay:function(){var e=h(s.default.mark(function e(){var t,o,n,r,a,l,c,d,f,h=this;return s.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("用户余额=> "+this.userBalance),console.log("需要支付=> "+this.userGoodsCarTotalPrice),!(this.userBalance<this.userGoodsCarTotalPrice)){e.next=5;break}return(0,u.default)("余额不足，请充值"),e.abrupt("return");case 5:for(u.default.loading({message:"支付中...",duration:0}),t=[],o=0;o<this.userGoodsCarGoodsList.length;o++)n=this.userGoodsCarGoodsList[o].goodsId,r=this.userGoodsCarGoodsList[o].count,a=n+"-"+r,t.push(a);return l=t.join(","),c={canteenNum:this.canteenID,boothNum:this.stallID,userId:this.store_UserInfoData.id,openId:this.store_UserInfoData.openId,body:l,money:this.userGoodsCarTotalPrice,mealId:1},console.log("发送订单，订单数据↓"),console.log(c),e.next=14,(0,i.http_paymentOrder)(c);case 14:d=e.sent,f&&clearTimeout(f),0===d.code||1===d.code||2===d.code?f=setTimeout(function(){(0,u.default)({type:"success",message:"下单成功",onClose:function(){h.clearGoodsCarAndOpenSuccPage(d.orderId,d.code)}})},1e3):!1===d&&(f=setTimeout(function(){(0,u.default)("支付失败，请检查网络")},1e3));case 17:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),clearGoodsCarAndOpenSuccPage:function(){var t=h(s.default.mark(function t(o,n){var r,a,i;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.userGoodsCarTotalCount>0)){t.next=21;break}r=0;case 2:if(!(r<this.store_userGoodsCarDatas.length)){t.next=21;break}if(this.store_userGoodsCarDatas[r].canteenId!=this.canteenID){t.next=18;break}a=0;case 5:if(!(a<this.store_userGoodsCarDatas[r].stalls.length)){t.next=17;break}if(this.store_userGoodsCarDatas[r].stalls[a].stallsId!=this.stallID){t.next=14;break}return i={canteenId:this.canteenID,stallId:this.stallID},t.next=10,this.clearUserGoodsCar(i);case 10:return console.log("清空该档口下购物车"),console.log(this.store_userGoodsCarDatas),e.reLaunch({url:"../../pages/succOrder/succOrder?orderId="+o+"&code="+n,complete:function(e){console.log(e)}}),t.abrupt("return");case 14:a++,t.next=5;break;case 17:return t.abrupt("return");case 18:r++,t.next=2;break;case 21:case"end":return t.stop()}},t,this)}));function o(e,o){return t.apply(this,arguments)}return o}(),computeCanteenStallGoodsCarCountAndTotalPriceAndGoodsList:function(e){if(this.userGoodsCarTotalPrice=0,this.userGoodsCarTotalCount=0,e.length>0){for(var t=0;t<e.length;t++)if(e[t].canteenId==this.canteenID)for(var o=0;o<e[t].stalls.length;o++)if(e[t].stalls[o].stallsId==this.stallID)for(var s=0;s<e[t].stalls[o].goodsList.length;s++)this.userGoodsCarTotalCount+=e[t].stalls[o].goodsList[s].count,this.userGoodsCarTotalPrice+=e[t].stalls[o].goodsList[s].count*Number(e[t].stalls[o].goodsList[s].goodsInfo.price),console.log("商品数量=> "+e[t].stalls[o].goodsList[s].count),console.log("商品单价=> "+Number(e[t].stalls[o].goodsList[s].goodsInfo.price)),this.userGoodsCarTotalPrice=Number(this.userGoodsCarTotalPrice.toFixed(2)),this.userGoodsCarGoodsList=e[t].stalls[o].goodsList;console.log("该食堂下、该档口的购物车  总数"),console.log(this.userGoodsCarTotalCount),console.log("该食堂下、该档口的购物车  总价格"),console.log(this.userGoodsCarTotalPrice),console.log("该食堂下、该档口的购物车  商品数据"),console.log(this.userGoodsCarGoodsList)}},findCanteenNameAndStallName:function(e){if(e.length>0)for(var t=0;t<e.length;t++)if(e[t].id==this.canteenID){this.canteenName=e[t].canteenName,console.log("食堂名↓"),console.log(this.canteenName);for(var o=0;o<e[t].stalls.length;o++)if(e[t].stalls[o].id==this.stallID)return this.stallName=e[t].stalls[o].name,console.log("档口名↓"),void console.log(this.stallName);return}}},(0,n.mapActions)(["clearUserGoodsCar"])),computed:c({},(0,n.mapGetters)(["store_userBalance","store_UserInfoData","store_userGoodsCarDatas","store_homeCanteenList"])),watch:{}};t.default=p}).call(this,o("543d")["default"])}},[["9c9b","common/runtime","common/vendor"]]]);